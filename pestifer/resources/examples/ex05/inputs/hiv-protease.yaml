# Author: Cameron F. Abrams, <cfa22@drexel.edu>
#
# pestifer input script
# 
# Build of solvated HIV protease 
#
# Notes:
#   - Using the 1f7a pdb entry
#   - The ligand (chain P) is removed
#   - ASPP patch to protonate ASP25 (catalytic residue)
#   - Acetates (ACT) are included by providing psfgen 
#     with segment type information and the appropriate
#     aliases to map to the CHARMM36 ACET residue.
#
title: HIV-1 protease dimer
psfgen:
  segtypes:
    other: ["ACET", "ACT"]
  aliases:
    residue:
      - "ACT ACET"
    atom:
      - "ACT CH3 C1"
      - "ACT O O1"
      - "ACT OXT O2"
      - "ACT C C2"
tasks:
  - fetch:
      sourceID: 1f7a
  - psfgen:
      source:
        exclude:
          - chainID == 'P'
      mods:
        mutations: # undoing engineered mutations; could also use 'fix_engineered_mutations: True' under source->sequence
          - A:LYS,7,GLN
          - B:LYS,7,GLN
          - A:ASN,25,ASP
          - B:ASN,25,ASP         
        patches:
          - ASPP:A:29
          - ASPP:B:29
  - md:
      ensemble: minimize
  - validate:
      tests:
        - residue_test:
            name: chain P excluded
            selection: chain P
            measure: residue_count
            value: 0
        - attribute_test:
            name: residue 7 is a GLN on chain A B
            selection: protein and chain A B and resid 7 and name CA
            attribute: resname
            value: GLN
            value_count: 2
        - attribute_test:
            name: residue 25 is an ASP on chain A B
            selection: protein and chain A B and resid 25 and name CA
            attribute: resname
            value: ASP
            value_count: 2
        - attribute_test:
            name: ASP29 protonated on chain A
            selection: protein and chain A B and resid 29
            attribute: name
            value: HD2
            value_count: 2
  - solvate:
  - md:
      ensemble: minimize
  - md:
      ensemble: NVT
  - md:
      ensemble: NPT
      nsteps: 200
  - md:
      ensemble: NPT
      nsteps: 400
  - md:
      ensemble: NPT
      nsteps: 800
  - md:
      ensemble: NPT
      nsteps: 1600
  - md:
      ensemble: NPT
      nsteps: 13200
  - mdplot:
      timeseries:
        - density
      basename: solvated
      grid: True
  - terminate:
      basename: my_1f7a
      archive_dir: arc
      package:
        state_dir: r2r
        basename: prod_1f7a
        md:
          ensemble: NPT
          nsteps: 500000