# Pestifer 1.0.1
# (c) 2023 Cameron F. Abrams, 2023
#
# Format specification for user configuration file
#
# The "name" of any directive may appear as a key whose value is specified by "type"
# and any dependent "directives".  Values with scalar types should only appear
# once in any directive set.  Values with list types may have multiple instances
# of each dependent directive.
#
# use "required: True" for scalar values that have no defaults but must be specified
# use "required: False" for any values that should not be assigned defaults
#
directives:
  - name: charmmff
    type: dict
    text: Specifications for charmm force-field parameter and topology files
    required: True 
    directives:
      - name: standard
        type: dict
        text: Standard charmmff files
        required: True 
        directives:
          - name: topologies
            type: list
            text: Standard charmmff topologies
            required: True
            default:
              - top_all36_prot.rtf
              - top_all35_ethers.rtf
              - top_all36_cgenff.rtf
              - top_all36_lipid.rtf
              - top_all36_carb.rtf
              - top_all36_na.rtf
              - stream/carb/toppar_all36_carb_glycopeptide.str
              - stream/prot/toppar_all36_prot_modify_res.str
          - name: parameters
            type: list
            text: Standard charmmff parameter files
            required: True
            default:
              - par_all36m_prot.prm
              - par_all36_carb.prm
              - par_all36_lipid.prm
              - par_all36_carb.prm
              - par_all36_na.prm
              - par_all36_cgenff.prm
              - stream/carb/toppar_all36_carb_glycopeptide.str
              - stream/prot/toppar_all36_prot_modify_res.str
      - name: custom
        type: dict
        text: Custom charmmff files
        required: True 
        directives:
          - name: topologies
            type: list
            text: Custom charmmff topology files
            default:
              - toppar_water_ions.str
              - toppar_all36_moreions.str
          - name: parameters
            type: list
            text: Custom charmmff parameter files
            default:
              - toppar_water_ions.str
              - toppar_all36_moreions.str
  - name: psfgen
    type: dict
    text: Specifications for the psfgen plugin
    required: True
    directives:
      - name: aliases
        type: list
        text: Psgfen atom and residue aliases
        required: True 
        default:
          - atom ILE CD1 CD
          - atom BGLCNA C7 C
          - atom BGLCNA O7 O
          - atom BGLCNA C8 CT
          - atom BGLCNA N2 N
          - atom ANE5 C10 C
          - atom ANE5 C11 CT
          - atom ANE5 N5 N
          - atom ANE5 O1A O11
          - atom ANE5 O1B O12
          - atom ANE5 O10 O
          - atom VCG C01 C1
          - atom VCG C01 C1
          - atom VCG C02 C2
          - atom VCG C03 C3
          - atom VCG C04 C4
          - atom VCG C05 C5
          - atom VCG C06 C6
          - atom VCG C07 C7
          - atom VCG C08 C8
          - atom VCG C09 C9
          - atom TIP3 O OH2
          - residue HIS HSD
          - residue PO4 H2PO4
          - residue H2PO H2PO4
          - residue MAN AMAN
          - residue BMA BMAN
          - residue NAG BGLCNA
          - residue BGLC BGLCNA
          - residue FUC AFUC
          - residue GAL BGAL
          - residue ANE5 ANE5AC
          - residue SIA ANE5AC
          - residue EIC LIN
          - residue HOH TIP3
          - residue ZN ZN2
          - residue CL CLA
      - name: segtypes
        type: dict
        text: Segment type specifications
        directives:
          - name: protein
            type: dict
            text: Protein segment type specifications
            directives:
              - name: resnames
                type: list
                text: Residue names in proteins
                default:
                  - ALA
                  - ARG
                  - ASN
                  - ASP
                  - CYS
                  - GLN
                  - GLU
                  - GLY
                  - HIS
                  - HSD
                  - HSE
                  - ILE
                  - LEU
                  - LYS
                  - MET
                  - PHE
                  - PRO
                  - SER
                  - THR
                  - TRP
                  - TYR
                  - VAL
              - name: rescodes
                type: dict
                text: one-letter residue name codes
                default:
                  ALA: A
                  ARG: R
                  ASN: N
                  ASP: D
                  CYS: C
                  GLN: Q
                  GLU: E
                  GLY: G
                  HSE: H
                  ILE: I
                  LEU: L
                  LYS: K
                  MET: M
                  PHE: F
                  PRO: P
                  SER: S
                  THR: T
                  TRP: W
                  TYR: Y
                  VAL: V
          - name: ion
            type: dict
            text: Ion segment specifications
            directives:
              - name: resnames
                type: list
                text: Residue names for ions
                default:
                  - LIT
                  - SOD
                  - MG
                  - POT
                  - CAL
                  - RUB
                  - CES
                  - BAR
                  - ZN
                  - CAD
                  - CL
                  - SO4
                  - PO4
                  - H2PO  # H2PO4 resname
          - name: ligand
            type: dict
            text: Ligand segment specifications
            directives:
              - name: resnames
                type: list
                text: Residue names for ligands
                default:
                  - EIC
                  - VCG
                  - 83G
          - name: glycan
            type: dict
            text: Glycan segment specifications
            directives:
              - name: resnames
                type: list
                text: Glycan residue names
                default:
                  - BMA
                  - FUC
                  - GAL
                  - MAN
                  - NAG
                  - SIA
                  - ANE5
                  - BGLC
          - name: water
            type: dict
            text: Water segment specifications
            directives:
              - name: resnames
                type: list
                text: Water residue names
                default:
                  - HOH
          - name: other
            type: dict
            text: Specifications for segments not recognized
            directives:
              - name: resnames
                type: list
                text: Unrecognized residue names
                default: []
  - name: namd2
    type: dict
    text: NAMD2 specifications
    directives:
      - name: generic
        type: dict
        text: Generic NAMD2 configuration parameters
        default:
          paraTypeCharmm: on
          exclude: scaled1-4
          1-4scaling: 1.0
          cutoff: 10.0
          switching: on
          switchdist: 9.0
          pairlistdist: 11.5
          outputenergies: 100
      - name: vacuum
        type: dict
        text: NAMD2 parameters for vacuum simulations
        default:
          nonbondedFreq: 1
          fullElectFrequency: 2
          stepspercycle: 4
          dielectric: 80
          timestep: 1.0
          rigidbonds: none
      - name: solvated
        type: dict
        text: NAMD2 parameters for solvated simulations
        default:
          timestep: 2.0
          rigidbonds: all
          nonbondedFreq: 1
          fullElectFrequency: 2
          stepspercycle: 10
          PME: on 
          pmegridspacing: 1.0
          wrapAll: on
      - name: thermostat
        type: dict
        text: NAMD2 thermostat parameters
        default:
          langevin: on 
          langevinDamping: 5
          langevinTemp: $temperature
          langevinHydrogen: no 
      - name: barostat
        type: dict
        text: NAMD2 barostat parameters
        default:
          langevinpiston: on 
          langevinpistontarget: $pressure
          langevinpistonperiod: 200
          langevinpistondecay: 100
          langevinpistontemp: $temperature
          usegrouppressure: yes
          useflexiblecell: no
      - name: harmonic
        type: dict
        text: parameters governing harmonic constraints; not necessarily NAMD-compatible keywords
        default:
          spring_constant: 200

  - name: title
    type: str
    text: Meaningful title (optional)
    default: Pestifer
  - name: paths
    type: dict
    text: Allows user to specify various paths
    directives:
      - name: namd2
        type: str
        text: Path for namd2 executable
        default: /usr/local/bin/namd2
      - name: charmrun
        type: str
        text: Path for charmrun executable
        default: /usr/local/bin/charmrun
      - name: vmd
        type: str
        text: Path for vmd executable
        default: /usr/local/bin/vmd
      - name: charmmff
        type: str
        text: Path for standard charmm force-field distribution; note that pestifer comes with the July 2022 distribution included and this is used by default
        required: False
  - name: tasks
    type: list
    text: Specifies the tasks to be performed serially
    directives:
      - name: psfgen
        text: Parameters controlling a psfgen run on an input molecule
        type: dict
        directives:
          - name: source
            text: Specifies the source of the initial coordinate file
            type: dict
            directives:
              - name: id 
                text: The 4-character PDB ID of the source or the basename of a local coordinate file (PDB or mmCIF format); pestifer will download from the RCSB if a file is not found
                type: str
                required: True
              - name: biological_assembly 
                text: integer index of the biological assembly to construct; default is 0, signifying that the asymmetric unit is to be used
                type: int
                default: 0
              - name: file_format
                text: either PDB or mmCIF; some entries do not have a PDB-format file.  The main advantage of PDB is that it uses the author-designations for chains by default.  mmCIF is the new "default" format of the PDB.
                type: str
                choices: [PDB, mmCIF]
                default: PDB
              - name: cif_residue_map_file
                text: name of output file to contain a mapping of CIF chain-residue number to author chain-residue number-insertion
                type: str
              - name: psf
                type: str
                text: An optional accompanying psf file (unused)
              - name: altcoords
                type: str
                text: An optional coordinate file that must be congruent (same atoms; same order) as base PDB file
              - name: exclude
                text: Specifies any residues or atoms present in the PDB source to exclude from the system
                type: dict
                directives:
                  - name: chains
                    text: Specify list of chain IDs to ignore; in PDB-format input, these are typically author-generated, while in mmCIF they are not.  You must use chain IDs that reference your chosen coordinate file input format.
                    type: list
                    required: False
                  - name: resnames
                    text: Specify list of resnames to ignore; good for excluding waters or ions or small molecules.  Resnames must reference your chosen coordinate input file.
                    type: list
                    required: False
              - name: sequence
                text: Parameters controlling sequence modifications based on specifications in the PDB source
                type: dict
                directives:
                  - name: include_terminal_loops
                    text: Specifies whether or not N- and C- terminal loops (if unresolved) are built in
                    type: bool
                    default: False
                  - name: build_zero_occupancy_C_termini
                    text: List of chain identifiers for which you would like zero-occupancy residues at the C-terminus built in
                    type: list
                    default: []
                  - name: build_zero_occupancy_N_termini
                    text: List of chain identifiers for which you would like zero-occupancy residues at the N-terminus built in
                    type: list
                    default: []
                  - name: fix_engineered_mutations
                    text: Specifies whether or not sequence differences w.r.t. a sequence database and which are labeled as "engineered mutation"s are reverted to their database values
                    type: bool
                    default: True 
                  - name: fix_conflicts 
                    text: Specifies whether or not sequence differences w.r.t. a sequence database and which are labeled as "conflicts"s are reverted to their database values
                    type: bool
                    default: True          
                  - name: loops
                    text: Parameters controlling model-built loops during psfgen
                    type: dict
                    directives:
                      - name: sac_res_name 
                        text: 3-letter code of residue appended to any sufficiently long model-built 
                        type: str
                        default: GLY
                      - name: min_loop_length
                        text: Minimum length of model-built loop that triggers the ligation algorithm
                        type: int
                        default: 4
                      - name: declash
                        text: Specifies how model-built residues are moved to avoid steric clashes
                        type: dict
                        directives:
                          - name: maxcycles
                            text: Maximum number of Metropolis cycles
                            type: int
                            default: 20
                  - name: glycans
                    text: parameters controlling how model-built glycans are adjusted, if present
                    type: dict
                    directives:
                      - name: declash
                        text: Specifies how glycan residues are moved to avoid steric clashes
                        type: dict
                        directives:
                          - name: maxcycles
                            text: Maximum number of Metropolis cycles
                            type: int
                            default: 20
                          - name: clashdist
                            text: interatomic distance threshold for clashes in Angstroms
                            type: float
                            default: 1.5
          - name: mods
            text: Specifies modifications to the sequence or structure in the PDB file
            type: dict
            directives:
              - name: mutations
                text: Single-residue mutations, expressed as shortcodes; e.g., C:F32A for mutation of Phe 32 on chain C to an Alanine
                type: list
              - name: ssbonds
                text: additional ssbonds, expressed as shortcodes; e.g., C_154-A_298 to add an ssbond between resids 154 of chain C and 298 of chain A.  Note that the indicated residues must by CYS's.  If they are not, you should include each in a mutation shortcode in the mutations list
                type: list
              - name: ssbondsdelete
                text: existing ssbonds to break, expressed as shortcodes; e.g., C_154-A_298 will break the existing ssbond between resids 154 of chain C and 298 of chain A so that each is a reduced CYS.
                type: list
              - name: deletions
                text: residue ranges to delete, expressed as shortcodes; e.g., C:99-101 deletes residues 99 to 101 (inclusive) of chain C
                type: list
              - name: substitutions
                text: residue ranges to replace with a new sequence; e.g., C:99-101,GG replaces residues 99, 100, and 101 of chain C with two glycines
                type: list
              - name: insertions
                text: sequence of residues to insert C-terminal to a specified residue in a specified chain; e.g., C,123,GRETA inserts the residues Gly123A, Arg123B, Glu123C, Thr123D, and Ala123E immediately C-terminal to residue 123 of chain C; if the resid includes a terminal "+", then inserted resids are incremented as integers
                type: list
              - name: crotations
                text: dihedral angle rotations to reposition modelled-in protein chains or glycans
                type: list
              - name: Cfusions
                text: fuse residues from named residue range of named protein chain of named input PDB coordinate file to C-terminus of named segment of base molecule
                type: list
              - name: grafts
                text: graft residues from named residue range of named chain of named input PDB coordinate file onto target residue of base molecule
                type: list
          - name: cleanup
            text: Specifies whether or not to delete temporary files generated during psfgen execution
            type: bool
            default: True
      - name: ligate
        text: Specifies how C-termini of modeled loops are connected back to the protein
        type: dict
        directives:
          - name: steer
            text: Specifies parameters for steered MD to bring C-termini close to their connection points
            type: dict
            directives:
              - name: ensemble
                text: Name of ensemble to run in; note that NPT can only be peformed on a solvated system
                type: str
                choices: [minimize, NVT, NPT]
                default: NVT
              - name: force_constant
                text: force constant (kcal/mol/Angstrom^2)
                type: float
                default: 20
              - name: target_distance
                text: distance (Angstrom) between carbonyl carbon of loop C-terminus and amide nitrogen of connecting residue that steered MD drives to
                type: float
                default: 2
              - name: nsteps
                text: number of MD time steps for steeering
                type: int
                default: 1000
              - name: dcdfreq
                text: number of time steps between configuration output to DCD file
                type: int
                default: 100
              - name: xstfreq
                text: number of time steps between cell size output to DCD file (only used if ensemble is NPT)
                type: int
                default: 100
              - name: temperature
                text: Temperature used in steered MD run
                type: float
                default: 300
              - name: pressure
                text: Pressure used in steered MD run (only used if ensemble is NPT)
                type: float
                default: 1
              - name: receiver_flexible_zone_radius
                text: size of zone around receiver N-terminal N in which CA's are not fixed during steered MD
                type: float
                default: 0.0 # all fixed by default
              - name: constraints
                text: Parameters controlling position constraints
                type: dict
                directives:
                  - name: atoms
                    text: Atoms to be position-constrained expressed as a VMD atomselection
                    type: string
                  - name: k
                    text: Restraint spring constant in kcal/mol/A^2
                    type: float
                  - name: consfile
                    text: Name of constraints PDB file (defaults to basename-constraints.pdb)
                    type: string
          - name: connect
            text: Specifies parameters of the psfgen run that patches in the new backbone bonds
            type: dict
            directives:
              - name: cleanup
                text: Specifies whether or not to clean up temporary files
                type: bool
                default: True
      - name: cleave
        text: Parameters controlling cleavage of one or more protein chains
        type: dict
        directives:
          - name: sites
            type: list
            text: List of site shortcodes in form C:R1-R2 where C is chain ID, R1 is resid+ins of residue N-terminal to cleavage site, R2 is residue C-terminal to cleavage site
      - name: domainswap
        text: Parameters controlling a domain swap TMD simulation
        type: dict
        directives:
          - name: swap_domain_def
            type: str
            text: VMD atomselect string for the domain; will be appended with "and chain X" for each chain
          - name: anchor_domain_def
            type: str
            text: VMD atomselect string for the anchor domains; will be appended with "and chain X" for each chain
          - name: chain_directional_swaps
            type: list
            text: list of pairs of directional swaps of chainIDs [[A,B], [B,A]] swaps A and B
          - name: force_constant
            type: float
            text: force constant used in biases for domain-swap CV MD simulation (200)
            default: 200.0
          - name: target_numsteps
            type: int
            text: number of timesteps to run the biased MD simulation
            default: 10000
          - name: nsteps
            type: int
            text: number of timesteps to run the biased MD simulation
            default: 10000
          - name: dcdfreq
            type: int
            text: number of timesteps between dcd output
            default: 100
          - name: xstfreq
            text: number of time steps between cell size output to DCD file
            type: int
            default: 100
          - name: temperature
            type: float
            text: temperature of thermostat in MD run
            default: 300
          - name: ensemble
            type: str
            text: ensemble in which MD is run [NVT]
            choices: [minimize, NVT, NPT]
            default: NVT
      - name: solvate
        text: Parameters controlling solvation and ionization
        type: dict
        directives:
          - name: pad
            text: padding value for determining the overall simulation box size (in Angstroms)
            type: float
            default: 10
      - name: md
        text: Parameters controlling a NAMD run
        type: dict
        directives:
          - name: ensemble
            text: Name of ensemble to run in; note that NPT can only be peformed on a solvated system
            type: str
            choices: [minimize, NVT, NPT]
            default: NVT
          - name: minimize
            text: Number of minimization steps; ignored if ensemble is not 'minimize' (used with the 'minimize' command)
            type: int
            default: 1000
          - name: nsteps
            text: Number of MD time steps; ingored if ensemble is 'minimize' (used with the 'run' command)
            type: int
            default: 2000
          - name: dcdfreq
            text: number of time steps between configuration output to DCD file
            type: int
            default: 100
          - name: xstfreq
            text: number of time steps between cell size output to DCD file
            type: int
            default: 100
          - name: temperature
            text: Temperature (K) for NVT or NPT
            type: float
            default: 300
          - name: pressure
            text: Pressure (bar) for NPT; note that NPT can only be peformed on a solvated system
            type: float
            default: 1
          - name: other_parameters
            text: key:value pairs for other namd2 configuration file statements
            type: dict
          - name: constraints
            text: Parameters controlling position constraints
            type: dict
            directives:
              - name: atoms
                text: Atoms to be position-constrained expressed as a VMD atomselection
                type: string
              - name: k
                text: Restraint spring constant in kcal/mol/A^2
                type: float
              - name: consfile
                text: Name of constraints PDB file (defaults to basename-constraints.pdb)
                type: string
      - name: manipulate
        text: Direct manipulation of atom positions
        type: dict
        directives:
          - name: mods
            text: Specifies modifications to the sequence or structure in the current structure
            type: dict
            directives:
              - name: crotations
                text: dihedral angle rotations to reposition residues
                type: list
      - name: terminate
        text: Task that signals end of task list
        type: dict
        directives:
          - name: basename
            text: Desired basename for final psf/pdb files
            type: str
            default: my_system
          - name: chainmapfile
            text: Desired name of the file describing all chain mapping
            type: str
            default: chainmaps.yaml
          - name: statefile
            text: Desired name of the file describing the current state
            type: str
            default: states.yaml
          - name: package
            text: Task that packages all CHARMM parameter files and pdb/psf/coor/vel/xsc files for a production run
            type: dict
            required: False
            directives:
              - name: basename
                text: Desired basename for final tarball
                type: str
                default: my_system
              - name: ensemble
                text: Name of ensemble to run in; note that NPT can only be peformed on a solvated system
                type: str
                choices: [NVT, NPT]
                default: NVT
              - name: nminsteps
                text: Number of minimization steps
                type: int
                default: 0
              - name: nsteps
                text: Number of MD time steps
                type: int
                default: 1000000
              - name: dcdfreq
                text: number of time steps between configuration output to DCD file
                type: int
                default: 10000
              - name: xstfreq
                text: number of time steps between cell size output to DCD file
                type: int
                default: 10000
              - name: restartfreq
                text: number of timesteps between restart checkpoints
                type: int
                default: 10000
              - name: temperature
                text: Temperature (K) for NVT or NPT
                type: float
                default: 300
              - name: pressure
                text: Pressure (bar) for NPT; note that NPT can only be peformed on a solvated system
                type: float
                default: 1
              - name: topogromacs
                text: Set to True if you want to use topogromacs to generate Gromacs-compatible PDB and TOP files
                type: bool
                default: False
              - name: constraints
                text: Parameters controlling position constraints
                type: dict
                directives:
                  - name: atoms
                    text: Atoms to be position-constrained expressed as a VMD atomselection
                    type: string
                  - name: k
                    text: Restraint spring constant in kcal/mol/A^2
                    type: float
                  - name: consfile
                    text: Name of constraints PDB file (defaults to basename-constraints.pdb)
                    type: string
