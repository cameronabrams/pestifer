# Author: Cameron F. Abrams, <cfa22@drexel.edu>
#
# pestifer input script
# 
# Membrane-embedded build of HIV-1 gp41 MPER-TM trimer (6e8w)
#
# Notes:
#   - Topology and parameters for cholesterol, sphingomyelin, and stearates are not loaded by default, so
#     we explicitly declare them here
#   - packmol-memgen is used.  A functional packmol-memgen is available if ambertools
#     >= 23.6 is installed.
#
title: HIV-1 gp41 MPER-TM trimer 6e8w embedded in a model viral membrane
charmmff:
  standard:
    topologies:
      - stream/lipid/toppar_all36_lipid_cholesterol.str
      - stream/lipid/toppar_all36_lipid_sphingo.str
      - stream/lipid/toppar_all36_lipid_miscellaneous.str
    parameters:
      - stream/lipid/toppar_all36_lipid_cholesterol.str
      - stream/lipid/toppar_all36_lipid_sphingo.str
      - stream/lipid/toppar_all36_lipid_miscellaneous.str
tasks:
  - psfgen:
      source:
        id: 6e8w
        model: 15 # last frame
  - md:
      ensemble: minimize
  - bilayer_embed:
      embed:
        z_head_group: "protein and resid 667"
        z_tail_group: "protein and resid 710"
        z_ref_group: 
          text: "protein and resid 696"
          z_value: 0.0
      xydist: 20
      zdist: 10
      lipids: CHL1:PSM:POPC//CHL1:POPE:SOPS:SOPE
      ratio: 0.4721:0.3554:0.1725//0.4333:0.0889:0.1778:0.3000
      # nloop: 200
  - solvate: # allow for explicit specification of cell dimensions
    - cation: POT
    - salt_con: 1.0
  - md:
      ensemble: minimize
      minimize: 5000
      other_parameters:
        wrapall: on
  - md:
      ensemble: NVT
  - md:
      ensemble: NPT
      nsteps: 200
  - md:
      ensemble: NPT
      nsteps: 400
  - md:
      ensemble: NPT
      nsteps: 800
  - md:
      ensemble: NPT
      nsteps: 1600
  - md:
      ensemble: NPT
      nsteps: 3200
  - md:
      ensemble: NPT
      nsteps: 6400
  - md:
      ensemble: NPT
      nsteps: 12800
  - md:
      ensemble: NPT
      nsteps: 25600
  - md:
      ensemble: NPT
      nsteps: 51200
  - mdplot:
      savedata: solvated.csv
      traces:
        - density
      units:
        density: g_per_cc
      basename: solvated
  - terminate:
      basename: my_6e8w
      package:
        ensemble: NPT
        basename: prod_6e8w